---
### デジタルICカードサービス 要件定義 (再改訂版)

このドキュメントは、モバイルSuicaのようなデジタルICカードサービスを構築するための主要な要件と技術選定をまとめたものです。
---

### 1. プロジェクト概要

- **目的:** スマートフォンで利用可能なデジタル IC カードサービスを開発する。本プロジェクトは**技術検証・学習目的のプロトタイプ**であり、**実際の金銭取引や公共交通機関との連携は行わない。** 決済機能はモック（ダミー）実装とし、NFC 機能は実験的な実装に留める。**今回のプロジェクトでは、アプリの公開・デプロイは行わない。**
- **ターゲットユーザー:** スマートフォンを利用する個人開発者、または技術デモとして利用するユーザー。
- **想定プラットフォーム:** iOS および Android のスマートフォン。

### 2. 機能要件

ユーザーがアプリで利用できる主要な機能です。

- **アカウント管理:**
  - ユーザー登録（メールアドレス、パスワード）
  - ソーシャルログイン（Google、Apple ID）
  - 生体認証（Touch ID / Face ID）によるログイン・認証
  - アカウント残高の表示
- **決済機能 (モック実装):**
  - 残高へのチャージ機能 **(デモモード)**
    - **実際には課金されず、アプリ内の仮想通貨として残高が増加する**
    - クレジットカード情報入力 UI は表示するが、決済ゲートウェイとの連携は行わない
    - 電子マネー（PayPay, LINE Pay など）表示は参考程度とし、実際の連携は行わない
    - アプリ内課金（Apple Pay, Google Pay）表示も参考程度とし、実際の連携は行わない
  - 公共交通機関での乗車時の決済 **(残高減少のシミュレーション)**
  - 提携店舗での買い物時の決済 **(残高減少のシミュレーション)**
- **定期券機能:**
  - 日本全国の公共交通機関の定期券発行 **(購入はモック決済)**
  - 発行済み定期券情報の表示
  - 定期券情報の更新・管理
- **QR コード切符機能:**
  - QR コード型の切符の発券
  - 発券済み QR コード切符の表示（発券した場合のみ）
  - QR コードを利用した乗車・入場 **(デモ機能)**
- **NFC 機能 (実験的実装):**
  - 簡易的な IC カードリーダーとの NFC 通信によるデータ読み取り機能の実験
- **履歴管理:**
  - 利用履歴（乗車、買い物、チャージなど）の表示

### 3. デザイン要件

アプリの視覚的な要素に関する要件です。

- **ブランドカラー:** 赤を基調としたデザイン。
- **アプリアイコン:** 「M」のロゴをあしらったミニマルなデザイン。
- **メイン画面レイアウト:**
  - 残高表示を中央上部に大きく表示。
  - 定期券情報を残高の下に中央揃えで表示。
  - QR コード表示は、QR コード型の切符を発券した場合にのみ表示され、定期券情報と切り替え可能。
  - フッターバーに「Home」「History（利用履歴）」「Charge（チャージ）」「Settings（設定）」などの主要メニューを配置。

### 4. 技術要件

アプリを構築するための技術スタックとインフラに関する要件です。

- **フロントエンド:**
  - **技術:** React Native (Expo を利用)
  - **理由:** クロスプラットフォーム開発の効率性、開発体験の向上、ネイティブ機能へのアクセス、高速な実機テスト。
- **バックエンド / データベース / 認証:**
  - **技術:** Supabase (PostgreSQL ベース)
  - **理由:** PostgreSQL の堅牢性、認証機能の統合、リアルタイムデータベース機能、開発の迅速性。
- **決済システム:**
  - **実装方針:** モック実装。実際の金銭取引は行わない。
  - **チャージ方法:** アプリ内での仮想通貨としての残高操作。
  - **決済ゲートウェイ:** 実際の連携は行わず、デモ用に UI を実装。
- **デプロイ/配布:**
  - **デプロイは行わない。** 開発中のアプリは、**Expo Go アプリ**や**ローカルビルド**で実機テストを行う。
  - Web 管理画面等も作成しない。
- **CI/CD (継続的インテグレーション/デリバリー):** 今回のスコープでは最小限の実装、または省略。

### 5. データベース構成 (Supabase / PostgreSQL)

主要なテーブルとリレーションシップの概要です。

- **主要テーブル:**
  - `users`: ユーザーの基本情報と認証情報。
  - `accounts`: ユーザーの IC カードアカウント情報と残高。
  - `transactions`: すべての取引履歴。
  - `commuter_passes`: 定期券情報。
  - `qr_tickets`: QR コード型切符情報。
  - `payment_methods`: 登録された支払い方法情報 (モック決済用に必要最低限の情報を保持)。
- **リレーションシップ:**
  - `users` は `accounts` に **1 対 1**。
  - `users` は `payment_methods` に **1 対多**。
  - `accounts` は `transactions` に **1 対多**。
  - `accounts` は `commuter_passes` に **1 対多**。
  - `accounts` は `qr_tickets` に **1 対多**。

---
