---
### デジタルICカードサービス 開発タスクリスト (再改訂版)

このタスクリストは、プロジェクトのフェーズごとに主要な開発項目を整理したものです。技術検証・学習目的のプロトタイプとして、決済機能はモック実装、NFC機能は実験的実装に重点を置き、**アプリの公開・デプロイは行いません。**
---

### Phase 1: 環境構築と初期セットアップ

1.  **プロジェクトの初期化**

    - Expo プロジェクトの作成 (`expo init`)
    - Supabase プロジェクトの作成と初期設定
    - Git リポジトリの作成と初期コミット

2.  **基本技術スタックのセットアップ**

    - React Native (Expo) 環境設定
    - Supabase クライアントライブラリのインストールと設定 (`@supabase/supabase-js`)
    - UI コンポーネントライブラリの選定と導入 (例: React Native Paper)

3.  **認証機能の初期セットアップ**
    - Supabase Authentication の基本設定（メール/パスワード）

### Phase 2: バックエンド (Supabase) の開発

1.  **データベーススキーマの設計と実装**

    - `users` テーブルの作成
    - `accounts` テーブルの作成と `users` とのリレーション設定
    - `payment_methods` テーブルの作成と `users` とのリレーション設定 (モック決済用に必要最低限の情報を保持)
    - `transactions` テーブルの作成と `accounts` とのリレーション設定
    - `commuter_passes` テーブルの作成と `accounts` とのリレーション設定
    - `qr_tickets` テーブルの作成と `accounts` とのリレーション設定
    - 各テーブルへのインデックス設定、制約（NOT NULL, UNIQUE）の定義

2.  **Row Level Security (RLS) の設定**

    - 各テーブルに対し、適切な RLS ポリシーを設定し、データアクセス権限を制御

### Phase 3: フロントエンド (React Native) の開発 - UI/UX と基本機能

1.  **ナビゲーションの実装**

    - React Navigation を用いた画面遷移とフッターナビゲーションの実装
    - ログイン後のメイン画面への遷移設定

2.  **認証 UI/UX の実装**

    - ログイン、サインアップ画面の作成と Supabase Authentication との連携
    - 生体認証（Touch ID/Face ID）の統合

3.  **メイン画面の UI/UX 実装**

    - 残高表示コンポーネントの実装と Supabase からのデータフェッチ
    - 定期券情報表示コンポーネントの実装と Supabase からのデータフェッチ (中央揃え)
    - QR コード切符表示コンポーネントの実装と表示条件のロジック

4.  **利用履歴機能の実装**

    - 利用履歴一覧画面の作成
    - Supabase からのトランザクションデータフェッチと表示

5.  **設定画面の基本実装**
    - ユーザー情報表示、ログアウト機能

### Phase 4: 決済機能の開発 **(モック実装)**

1.  **支払い方法管理機能の実装 (モック)**

    - 支払い方法の追加・削除 UI（**実際のカード情報連携は行わない**）
    - Supabase の`payment_methods`テーブルに仮想の支払い方法情報を保存

2.  **チャージ機能の実装 (モック)**
    - チャージ金額入力 UI
    - **決済ゲートウェイ連携は行わず、内部的に残高を増加させるモックロジックを実装**
    - Supabase `accounts` テーブルの残高更新ロジック
    - `transactions` テーブルへのチャージ履歴記録 (種別を「デモチャージ」などと区別)

### Phase 5: 定期券・QR コード切符機能の開発

1.  **定期券の発行/管理機能**

    - 定期券区間、期間選択 UI
    - 定期券購入フローと**モック決済**（内部的に残高を減少させる）
    - Supabase `commuter_passes` テーブルへのデータ保存
    - メイン画面での定期券情報の詳細表示

2.  **QR コード切符の発券/利用機能**

    - QR コード切符の発券 UI
    - 発券時の`qr_tickets`テーブルへのデータ保存
    - メイン画面での QR コード切符の表示ロジック
    - QR コードリーダーとの連携機能（カメラアクセス）

3.  **NFC 機能の実験的実装**
    - `react-native-nfc-manager` などのライブラリ導入
    - 簡易的な IC カードリーダーから NFC タグを読み取る基本的な機能の実装
    - 読み取ったデータをアプリ内で表示するなどの実験

### Phase 6: テストとデバッグ、学習/検証

1.  **テストの実装**

    - ユニットテスト (Jest)
    - コンポーネントテスト (React Native Testing Library)
    - E2E テスト (Detox/Appium) の導入と主要機能のテストシナリオ作成

2.  **CI/CD (継続的インテグレーション/デリバリー):**

    - **今回のスコープでは、CI/CD パイプラインの構築は省略する。**
    - 必要に応じて、GitHub Actions などでの自動テスト実行のみを検討。

3.  **実機での動作確認とデバッグ**

    - Expo Go アプリを用いた開発中の機能テストとデバッグ
    - ローカルビルド (`eas build`) によるスタンドアロンアプリのテストとデバッグ

4.  **技術検証と学習**
    - 実装した機能の動作検証と、各技術要素（Expo, Supabase, NFC など）に関する学習と知見の蓄積

---
